pipeline {
  agent none
  tools {
     maven 'Maven-3.5.4'
  }
  parameters {
      // create a job parameter for this pipeline with a default
      booleanParam(defaultValue: false, description: 'Simulate the promotion', name: 'SIMUL')
  }
  stages {
    /*
    stage('Stage: when') {
    	when {
    		branch 'master'
    	}
    }
    */
    stage('Stage: when') {
       when {
          expression {
              // only run when the expression is true
              currentBuild.getNumber() % 2 == 1
          }
       }
       steps {
          // call the current job and pass the SIMUL parameter value
          build job: currentBuild.getProjectName(), parameters: [
              booleanParam(name: 'SIMUL', value: params.SIMUL)
          ]
       }
    }

    stage("Stage: When, Input") {
       echo "running stage level"
       environment {
          OUTPUT_PATH = './outputs/'
          AN_ACCESS_KEY = credentials('my-prefined-secret-text')
       }
      /*
      input{
            message "Press Ok to continue"
            submitter "user1,user2"
            parameters {
                string(name:'username', defaultValue: 'user', description: 'Username of the user pressing Ok')
            }
      }
      */

    }
    stage('Parallel stages') {
        parallel {
            stage('Unit Test') {
                steps {
                  echo "running test"
                  sleep 10
                  echo "steps can be used to call the class directly and run that step."
                  step([$class: 'ArtifactArchiver', artifacts: 'msg.out', fingerprint: true])
                }
            }
            stage('Integration test Test On Linux') {
                steps {
                  echo "running integration"
                  sleep 5
                  step([$class: 'ArtifactArchiver', artifacts: 'msg.out', fingerprint: true])
                }
            }
        }
    }
    stage("Step Level") {
       echo "running step level"
       /*
         input{
               message "Press Ok to continue"
               submitter "user1,user2"
               parameters {
                   string(name:'username', defaultValue: 'user', description: 'Username of the user pressing Ok')
               }
         }
         */
       steps {
           echo "hello"
           // Running Shell script: Parentheses are optional when a single parameter is used
           sh('echo $PATH')
           sh 'echo $PATH'
           // Some steps may not be fully implemented with symbols or step names to run directly
           // steps can be used to call the class directly and run that step.
           step([$class: 'ArtifactArchiver', artifacts: 'msg.out', fingerprint: true])
           //Running Scripted pipeline code
           script {
             echo "HOW R U"
           }
       }


    }

  }
  post {
    always {
      echo "I ALWAYS run firsts"
    }
    unstable {
      echo "UNSTABLE runs after ALWAYS"
    }
  }
}